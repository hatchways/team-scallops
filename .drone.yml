kind: pipeline
type: docker
name: CD
#here we are continuously delivering a version to docker hub, even if it's breaking.
steps:
  - name: publish
    image: plugins/docker
    settings:
      enviroment:
        NODE_ENV: development
      registry:
        from_secret: registry
      repo:
        from_secret: docker_repo
      username: destintech
      #        from_secret: registry_username
      password:
        from_secret: registry_password
      dockerfile: Dockerfile
      tags:
        - latest
        - 0.0.5

---
kind: pipeline
type: kubernetes
name: publish
steps:
  - name: publish
    image: quay.io/honestbee/drone-kubernetes
    settings:
      kubernetes_server:
        from_secret: kube_server
      kubernetes_token:
        from_secret: kube_token
      namespace: lovingsitter
      deployment: lovingsitter
      repo:
        from_secret: docker_repo
      tag: latest
depends_on:
  - CD
